= Notes on the test machinery = 

A .fi extension means it's a git fast-import stream.  
An .svn extension means it's a Subversion repo dump.
A .chk extension means it's expected output from a test
A .tst extension means it's a test driver script

== The tests ==

Keeping live Subversion repos under version control doesn't work very well; 
in particular, things like the entries file change too often.  So what we 
do is keep Subversion dump files and rebuild the repo before each test.

In general, a file named foo.chk is the expected output from a test involving
either some operation test on an input stream in foo.fi or a repo conversion
from foo.sd.  Here is a summary of the test sources:

|=============================================================================
|bzr.fi          |Test for processing and round-tripping of bzr extensions.
|cut.fi          |Test load for cut operation; uses bzr repo
|deletion.svn    |Tests translation of file deletions
|deepdirs.svn    |Branchy repo with directory copy and delete
|deleteall.fi    |Tests roundtripping of deleteall operation 
|emptybranch.svn |Branchy repo with empty branch at top level
|exiguous.svn    |Branchy repo with exiguous branch at top level
|filecopy.svn	 |Test to make sure file copies don't confuse branch detection.
|graft.tst       |Grafts together the bzr and testrepo repositories
|ignores.fi      |Flat repo.  Tests for turning svn:ignore into .gitignore
|nontipcopy.svn  |Two branches, with the creation right after a tag copy
|nut.mbox        |Mailboxed comments used for the reference-lifting test
|nut.svn         |Head segment of NUT-UPS repo with lots of cvs2svn cruft in it
|references.tst  |Test author mapping and reference lifting 
|rootfile.svn    |Branchy layout with a file at the root level.
|roundup.fi      |Early segment of the Roundup tracker repo
|roundup.tst     |Test to see how it renders  the two different botched starts
|samplebranch.svn|Two-branch history with interleaved commits.
|simple.fi       |Earlier version of the reposurgeon repo, kept as a test
|simple.tst      |Test expression interpreter and basic operations
|simpletag.svn   |Standard layout. Linear. A couple of tags and no branches.
|testrepo.fi     |Synthetic repo made to check deltion results
|testrepo.tst    |Exercises all the deletion cases, with coverage checks
|uncoalesced.fi  |Repo with unsquashed squashable commits from the SNG project
|uncoalesced.tst |Exercises all the deletion cases, with coverage checks
|unite.tst       |Test unite on bzr and testrepo
|vanilla.svn     |Standard layout. Linear. Simplest case, no tags or branches.
|=============================================================================

=== Making new Subversion test loads ===

1. To create a new Subversion test repo, 'make svn-flat' or 'make svn-branchy'.

2. To clone an existing test load foo.svn into the test repo, 'svn -n <foo.svn'

3. To copy trunk, creating a tag named 'foo'

   svn copy file://${PWD}/test-repo/trunk file://${PWD}/test-repo/tags/foo

4. To delete a branch foo

   svn delete file://${PWD}/test-repo/branches/foo

5. 'make svn-dump' will dump the new test load to stdout.


